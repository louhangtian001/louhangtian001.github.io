<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIçŒ«å’ªç‰¹è®­ï¼ˆå®Œå…¨è‡ªå®šä¹‰ç‰ˆï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- åŸºç¡€å¸ƒå±€ --- */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f3f4f6;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Microsoft YaHei", sans-serif;
        }

        #scale-wrapper {
            transform-origin: center center;
            transition: transform 0.2s ease;
        }

        .game-container {
            width: 900px !important;
            height: 600px !important;
            position: relative;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            flex-shrink: 0;
        }

        .game-bg {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, #fff7ed, #fed7aa);
            z-index: 0;
        }

        /* --- è®¾ç½®é¢æ¿ (å‡çº§ç‰ˆï¼šæ»šåŠ¨+æŠ˜å ) --- */
        .settings-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            bottom: 10px;
            width: 240px;
            background: rgba(255, 255, 255, 0.96);
            border-radius: 12px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            flex-direction: column;
            border: 1px solid #e5e7eb;
        }

        .panel-header {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: bold;
            text-align: center;
            background: #f9fafb;
            border-radius: 12px 12px 0 0;
            color: #374151;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto; /* å…è®¸å†…éƒ¨æ»šåŠ¨ */
            padding: 10px;
        }
        
        /* éšè—æ»šåŠ¨æ¡ç¾åŒ– */
        .panel-content::-webkit-scrollbar { width: 4px; }
        .panel-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        .group-box {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 12px;
        }
        
        .group-title {
            font-size: 12px;
            font-weight: bold;
            color: #4b5563;
            margin-bottom: 6px;
            border-left: 3px solid #f59e0b;
            padding-left: 6px;
        }

        .control-row {
            margin-bottom: 6px;
        }
        
        .input-label {
            font-size: 10px;
            color: #64748b;
            display: block;
            margin-bottom: 2px;
        }

        .text-input {
            width: 100%;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            padding: 4px;
            font-size: 11px;
        }

        .file-btn {
            display: block;
            width: 100%;
            text-align: center;
            background: #e2e8f0;
            color: #475569;
            padding: 4px 0;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            transition: 0.2s;
            border: 1px dashed #94a3b8;
        }
        .file-btn:hover { background: #cbd5e1; }
        .file-btn.has-file { background: #dcfce7; border-color: #22c55e; color: #15803d; }

        input[type="file"] { display: none; }

        /* --- æ¸¸æˆæ ¸å¿ƒå…ƒç´  --- */
        .cat-container {
            position: absolute;
            top: 40px;
            left: 50%; /* ä¿®æ­£ä¸º50% */
            transform: translateX(-50%); /* ä¿®æ­£å±…ä¸­ */
            width: 240px;
            height: 240px;
            z-index: 10;
            margin-left: 80px; /* è®©çŒ«ç¨å¾®åå³ä¸€ç‚¹ï¼Œå› ä¸ºå·¦ä¾§æœ‰è®¾ç½®é¢æ¿ */
        }

        .cat-paw {
            position: absolute;
            top: 200px;
            left: 50%;
            width: 70px;
            height: 70px;
            z-index: 20;
            transform: translate(-50%, 0);
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* å¼¹æ€§åŠ¨ç”» */
            margin-left: 80px; /* è·ŸéšçŒ«çš„åç§» */
            pointer-events: none;
        }

        /* çˆªå­ä½ç½®å®šä¹‰ */
        .paw-rest { transform: translate(-50%, 0) rotate(0deg); }
        .paw-left { transform: translate(calc(-50% - 160px), 140px) rotate(-25deg); }
        .paw-right { transform: translate(calc(-50% + 160px), 140px) rotate(25deg); }

        .items-area {
            position: absolute;
            bottom: 60px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 150px;
            z-index: 15;
            padding-left: 160px; /* æŠµæ¶ˆé¢æ¿å®½åº¦ï¼Œä¿æŒè§†è§‰å±…ä¸­ */
        }

        .item-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.1s;
            position: relative;
        }
        .item-card:active { transform: scale(0.95); }

        .item-circle {
            width: 130px;
            height: 130px;
            background: rgba(255,255,255,0.6);
            border: 4px solid #fff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .item-img {
            width: 85%;
            height: 85%;
            object-fit: contain;
        }

        .item-name-tag {
            margin-top: 10px;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
        }

        /* çŠ¶æ€æç¤ºæ³¡ */
        .status-bubble {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .show-bubble { opacity: 1; top: -50px; }

    </style>
</head>
<body>

    <div id="scale-wrapper">
        <div class="game-container">
            <div class="game-bg"></div>

            <!-- å·¦ä¾§è¶…å¤§è®¾ç½®é¢æ¿ -->
            <div class="settings-panel">
                <div class="panel-header">ğŸ® è®­ç»ƒå¸ˆæ§åˆ¶å°</div>
                <div class="panel-content">
                    
                    <!-- 1. å·¦ç‰©å“è®¾ç½® -->
                    <div class="group-box">
                        <div class="group-title">å·¦ä¾§ç‰©å“ (Item 1)</div>
                        <div class="control-row">
                            <span class="input-label">åç§°</span>
                            <input type="text" class="text-input" value="å°é±¼å¹²" oninput="updateText('left', this.value)">
                        </div>
                        <div class="control-row">
                            <span class="input-label">å›¾ç‰‡</span>
                            <label class="file-btn" for="file-img-left">ä¸Šä¼ å›¾ç‰‡</label>
                            <input type="file" id="file-img-left" accept="image/*" onchange="loadImg(event, 'img-left')">
                        </div>
                        <div class="control-row">
                            <span class="input-label">ä¸“å±è¯­éŸ³ (å¦‚: "é±¼!")</span>
                            <label class="file-btn" id="lbl-audio-left" for="file-audio-left">ä¸Šä¼ è¯­éŸ³</label>
                            <input type="file" id="file-audio-left" accept="audio/*" onchange="loadAudio(event, 'left')">
                        </div>
                    </div>

                    <!-- 2. å³ç‰©å“è®¾ç½® -->
                    <div class="group-box">
                        <div class="group-title">å³ä¾§ç‰©å“ (Item 2)</div>
                        <div class="control-row">
                            <span class="input-label">åç§°</span>
                            <input type="text" class="text-input" value="è€é¼ " oninput="updateText('right', this.value)">
                        </div>
                        <div class="control-row">
                            <span class="input-label">å›¾ç‰‡</span>
                            <label class="file-btn" for="file-img-right">ä¸Šä¼ å›¾ç‰‡</label>
                            <input type="file" id="file-img-right" accept="image/*" onchange="loadImg(event, 'img-right')">
                        </div>
                        <div class="control-row">
                            <span class="input-label">ä¸“å±è¯­éŸ³ (å¦‚: "è€é¼ !")</span>
                            <label class="file-btn" id="lbl-audio-right" for="file-audio-right">ä¸Šä¼ è¯­éŸ³</label>
                            <input type="file" id="file-audio-right" accept="audio/*" onchange="loadAudio(event, 'right')">
                        </div>
                    </div>

                    <!-- 3. ä¸»è§’è®¾ç½® -->
                    <div class="group-box">
                        <div class="group-title">ä¸»è§’å½¢è±¡</div>
                        <div class="control-row">
                            <label class="file-btn" for="file-cat">æ›´æ¢çŒ«å’ª</label>
                            <input type="file" id="file-cat" accept="image/*" onchange="loadImg(event, 'img-cat')">
                        </div>
                        <div class="control-row">
                            <label class="file-btn" for="file-paw">æ›´æ¢çŒ«çˆª</label>
                            <input type="file" id="file-paw" accept="image/*" onchange="loadImg(event, 'img-paw')">
                        </div>
                    </div>

                    <!-- 4. ç»“æœéŸ³æ•ˆ -->
                    <div class="group-box">
                        <div class="group-title">åé¦ˆéŸ³æ•ˆ</div>
                        <div class="control-row">
                            <span class="input-label">æˆåŠŸè¯­éŸ³ (å¦‚: "çœŸæ£’!")</span>
                            <label class="file-btn" id="lbl-audio-success" for="file-audio-success">ä¸Šä¼ æˆåŠŸéŸ³</label>
                            <input type="file" id="file-audio-success" accept="audio/*" onchange="loadAudio(event, 'success')">
                        </div>
                        <div class="control-row">
                            <span class="input-label">é”™è¯¯éŸ³æ•ˆ (å¦‚: "å—¡~")</span>
                            <label class="file-btn" id="lbl-audio-fail" for="file-audio-fail">ä¸Šä¼ é”™è¯¯éŸ³</label>
                            <input type="file" id="file-audio-fail" accept="audio/*" onchange="loadAudio(event, 'fail')">
                        </div>
                    </div>

                </div>
            </div>

            <!-- æ¸¸æˆåŒºåŸŸ -->
            <div class="cat-container">
                <img id="img-cat" src="https://api.iconify.design/noto:cat-face.svg" style="width:100%; height:100%; object-fit: contain;">
            </div>

            <div id="paw" class="cat-paw">
                <img id="img-paw" src="https://api.iconify.design/emojione:paw-prints.svg" style="width:100%; height:100%; object-fit: contain; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.2));">
            </div>

            <div class="items-area">
                <!-- å·¦ç‰©å“ -->
                <div class="item-card" onclick="trainCat('left')">
                    <div class="status-bubble" id="bubble-left">é€‰è¿™é‡Œ!</div>
                    <div class="item-circle">
                        <img id="img-left" src="https://api.iconify.design/noto:fish.svg" class="item-img">
                    </div>
                    <div id="txt-left" class="item-name-tag">å°é±¼å¹²</div>
                </div>

                <!-- å³ç‰©å“ -->
                <div class="item-card" onclick="trainCat('right')">
                    <div class="status-bubble" id="bubble-right">é€‰è¿™é‡Œ!</div>
                    <div class="item-circle">
                        <img id="img-right" src="https://api.iconify.design/noto:mouse-face.svg" class="item-img">
                    </div>
                    <div id="txt-right" class="item-name-tag">è€é¼ </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. èµ„æºç®¡ç†å™¨ ---
        const assets = {
            audio: {
                left: null,
                right: null,
                success: null,
                fail: null
            }
        };

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function loadImg(event, imgId) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById(imgId).src = URL.createObjectURL(file);
            }
        }

        // å¤„ç†éŸ³é¢‘ä¸Šä¼ 
        function loadAudio(event, key) {
            const file = event.target.files[0];
            if (file) {
                assets.audio[key] = new Audio(URL.createObjectURL(file));
                // æ›´æ–°æŒ‰é’®æ ·å¼è¡¨ç¤ºå·²ä¸Šä¼ 
                document.getElementById('lbl-audio-' + key).classList.add('has-file');
                document.getElementById('lbl-audio-' + key).innerText = "å·²åŠ è½½";
            }
        }

        // æ›´æ–°æ–‡å­—
        function updateText(side, text) {
            document.getElementById('txt-' + side).innerText = text || (side==='left'?'ç‰©å“1':'ç‰©å“2');
        }

        // --- 2. æ ¸å¿ƒæ’­æ”¾åŠŸèƒ½ (å¸¦é»˜è®¤å€¼) ---
        function playSound(key, fallbackText) {
            if (assets.audio[key]) {
                assets.audio[key].currentTime = 0;
                assets.audio[key].play();
            } else {
                // å¦‚æœæ²¡æœ‰ä¸Šä¼ æ–‡ä»¶ï¼Œä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„è¯­éŸ³åˆæˆ (TTS) ä½œä¸ºé»˜è®¤
                const u = new SpeechSynthesisUtterance(fallbackText);
                u.lang = 'zh-CN';
                u.rate = 1.2;
                speechSynthesis.speak(u);
            }
        }

        // ç®€å•çš„ beep éŸ³ç”Ÿæˆå™¨ (å¦‚æœæ²¡ä¸Šä¼ é”™è¯¯éŸ³æ•ˆæ—¶ç”¨)
        function playBeep() {
            if(assets.audio.fail) {
                playSound('fail');
                return;
            }
            // ç®€å•çš„ Web Audio API èœ‚é¸£å£°
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.3);
        }

        // --- 3. æ¸¸æˆé€»è¾‘ ---
        let isBusy = false; // é˜²æ­¢é‡å¤ç‚¹å‡»

        async function trainCat(targetSide) {
            if (isBusy) return;
            isBusy = true;

            const paw = document.getElementById('paw');
            const oppositeSide = targetSide === 'left' ? 'right' : 'left';
            
            // 1. æ’­æ”¾ç‰©å“åç§°è¯­éŸ³ (ä¾‹å¦‚ï¼š"é±¼ï¼")
            const itemName = document.getElementById('txt-' + targetSide).innerText;
            playSound(targetSide, itemName);

            // 2. æ˜¾ç¤ºæ°”æ³¡æç¤ºç”¨æˆ·ç‚¹å‡»äº†å“ªé‡Œ
            showBubble(targetSide);

            // 3. æ¨¡æ‹ŸçŒ«å’ªæ€è€ƒæ—¶é—´ (0.3ç§’)
            await wait(300);

            // 4. çŒ«å’ªéšæœºé€‰æ‹© (50% å¯¹ï¼Œ50% é”™)
            // è¿™é‡Œçš„ Math.random() < 0.5 å†³å®šçŒ«å’ªç¬¬ä¸€æ¬¡æ˜¯å¦å¬è¯
            const catChoice = Math.random() < 0.5 ? targetSide : oppositeSide;

            if (catChoice === targetSide) {
                // Situation A: çŒ«å’ªé€‰å¯¹äº†
                await movePawTo(targetSide);
                playSound('success', 'çœŸæ£’ï¼');
                await wait(1000);
                resetPaw();
            } else {
                // Situation B: çŒ«å’ªé€‰é”™äº† (çè’™æ¨¡å¼)
                await movePawTo(oppositeSide); // ç§»åˆ°é”™è¯¯é‚£è¾¹
                
                // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                playBeep(); 

                // åœé¡¿ 1 ç§’ (å±•ç¤º"æ„£ä½"çš„æ•ˆæœ)
                await wait(1000);

                // è‡ªåŠ¨ä¿®æ­£ï¼šç§»åˆ°æ­£ç¡®çš„ç‰©å“
                resetPaw(); // å…ˆæ”¶ä¸€ä¸‹æ‰‹
                await wait(200); 
                await movePawTo(targetSide); // å†å»æ­£ç¡®çš„
                
                // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                playSound('success', 'çœŸæ£’ï¼');
                await wait(1000);
                resetPaw();
            }

            isBusy = false;
        }

        // åŠ¨ç”»è¾…åŠ©å‡½æ•°
        function movePawTo(side) {
            return new Promise(resolve => {
                const paw = document.getElementById('paw');
                paw.className = `cat-paw paw-${side}`;
                setTimeout(resolve, 600); // ç­‰å¾…CSSè¿‡æ¸¡å®Œæˆ
            });
        }

        function resetPaw() {
            const paw = document.getElementById('paw');
            paw.className = `cat-paw paw-rest`;
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showBubble(side) {
            const b = document.getElementById('bubble-' + side);
            b.classList.add('show-bubble');
            setTimeout(() => b.classList.remove('show-bubble'), 1000);
        }

        // --- 4. å±å¹•é€‚é… ---
        function resizeGame() {
            const gameWidth = 900;
            const gameHeight = 600;
            const scale = Math.min(
                (window.innerWidth - 20) / gameWidth,
                (window.innerHeight - 20) / gameHeight,
                1
            );
            document.getElementById('scale-wrapper').style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizeGame);
        resizeGame();

    </script>
</body>
</html>
