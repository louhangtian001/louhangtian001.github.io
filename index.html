<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIçŒ«å’ªç‰¹è®­ï¼ˆå¯ä¿å­˜ç‰ˆï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- åŸºç¡€å¸ƒå±€ --- */
        body { margin: 0; padding: 0; overflow: hidden; background-color: #f3f4f6; height: 100vh; display: flex; justify-content: center; align-items: center; font-family: "Microsoft YaHei", sans-serif; }
        #scale-wrapper { transform-origin: center center; transition: transform 0.2s ease; }
        .game-container { width: 900px !important; height: 600px !important; position: relative; background-color: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; flex-shrink: 0; }
        .game-bg { position: absolute; inset: 0; background: linear-gradient(to bottom, #fff7ed, #fed7aa); z-index: 0; }

        /* --- è®¾ç½®é¢æ¿ --- */
        .settings-panel { position: absolute; top: 10px; left: 10px; bottom: 10px; width: 250px; background: rgba(255, 255, 255, 0.98); border-radius: 12px; box-shadow: 2px 0 15px rgba(0,0,0,0.1); z-index: 100; display: flex; flex-direction: column; border: 1px solid #e5e7eb; transition: transform 0.3s ease; }
        .settings-panel.collapsed { transform: translateX(-260px); }
        
        .panel-header { padding: 12px; border-bottom: 1px solid #e5e7eb; font-weight: bold; display: flex; justify-content: space-between; align-items: center; background: #f9fafb; border-radius: 12px 12px 0 0; color: #374151; }
        .toggle-btn { cursor: pointer; font-size: 18px; padding: 0 5px; }
        
        /* å±•å¼€æŒ‰é’®ï¼ˆå½“é¢æ¿éšè—æ—¶æ˜¾ç¤ºï¼‰ */
        .open-panel-btn { position: absolute; top: 10px; left: 10px; z-index: 90; background: white; padding: 8px 12px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; font-weight: bold; display: none; }
        .settings-panel.collapsed + .open-panel-btn { display: block; }

        .panel-content { flex: 1; overflow-y: auto; padding: 10px; }
        .panel-content::-webkit-scrollbar { width: 4px; }
        .panel-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        .group-box { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 8px; margin-bottom: 12px; }
        .group-title { font-size: 12px; font-weight: bold; color: #4b5563; margin-bottom: 6px; border-left: 3px solid #f59e0b; padding-left: 6px; }
        .control-row { margin-bottom: 6px; }
        .input-label { font-size: 10px; color: #64748b; display: block; margin-bottom: 2px; }
        .text-input { width: 100%; border: 1px solid #cbd5e1; border-radius: 4px; padding: 4px; font-size: 11px; }
        
        .file-btn { display: block; width: 100%; text-align: center; background: #e2e8f0; color: #475569; padding: 5px 0; border-radius: 4px; font-size: 10px; cursor: pointer; transition: 0.2s; border: 1px dashed #94a3b8; }
        .file-btn:hover { background: #cbd5e1; }
        .file-btn.has-file { background: #dcfce7; border-color: #22c55e; color: #15803d; font-weight: bold; }
        input[type="file"] { display: none; }

        /* ä¿å­˜æŒ‰é’® */
        .save-btn { background: #3b82f6; color: white; border: none; padding: 10px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px; margin-top: 10px; transition: background 0.2s; }
        .save-btn:hover { background: #2563eb; }

        /* --- æ¸¸æˆæ ¸å¿ƒå…ƒç´  --- */
        .cat-container { position: absolute; top: 40px; left: 50%; transform: translateX(-50%); width: 240px; height: 240px; z-index: 10; margin-left: 0; transition: margin 0.3s; }
        .cat-paw { position: absolute; top: 200px; left: 50%; width: 70px; height: 70px; z-index: 20; transform: translate(-50%, 0); transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); pointer-events: none; margin-left: 0; }
        
        /* åç§»ä¿®æ­£ï¼ˆå½“é¢æ¿æ‰“å¼€æ—¶ï¼Œæ¸¸æˆå…ƒç´ å³ç§»ä»¥å…é®æŒ¡ï¼‰ */
        body:not(.panel-closed) .cat-container, 
        body:not(.panel-closed) .cat-paw, 
        body:not(.panel-closed) .items-area { margin-left: 100px; }

        .paw-rest { transform: translate(-50%, 0) rotate(0deg); }
        .paw-left { transform: translate(calc(-50% - 160px), 140px) rotate(-25deg); }
        .paw-right { transform: translate(calc(-50% + 160px), 140px) rotate(25deg); }

        .items-area { position: absolute; bottom: 60px; left: 0; width: 100%; display: flex; justify-content: center; gap: 150px; z-index: 15; transition: margin 0.3s; }
        .item-card { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: transform 0.1s; position: relative; }
        .item-card:active { transform: scale(0.95); }
        .item-circle { width: 130px; height: 130px; background: rgba(255,255,255,0.6); border: 4px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 6px 12px rgba(0,0,0,0.1); overflow: hidden; }
        .item-img { width: 85%; height: 85%; object-fit: contain; }
        .item-name-tag { margin-top: 10px; background: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 14px; }
        .status-bubble { position: absolute; top: -40px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 4px 10px; border-radius: 8px; font-size: 12px; opacity: 0; transition: opacity 0.3s; white-space: nowrap; pointer-events: none; }
        .show-bubble { opacity: 1; top: -50px; }
    </style>
</head>
<body>

    <div id="scale-wrapper">
        <div class="game-container">
            <div class="game-bg"></div>

            <!-- éšè—çš„éŸ³é¢‘å®¹å™¨ (ç”¨äºæŒä¹…åŒ–ä¿å­˜) -->
            <div id="audio-store" style="display:none;">
                <audio id="audio-left"></audio>
                <audio id="audio-right"></audio>
                <audio id="audio-success"></audio>
                <audio id="audio-fail"></audio>
            </div>

            <!-- ä¾§è¾¹é¢æ¿ -->
            <div class="settings-panel" id="settingsPanel">
                <div class="panel-header">
                    <span>ğŸ® è®­ç»ƒå¸ˆæ§åˆ¶å°</span>
                    <span class="toggle-btn" onclick="togglePanel()">Ã—</span>
                </div>
                <div class="panel-content">
                    
                    <div class="group-box">
                        <div class="group-title">å·¦ä¾§ç‰©å“ (Item 1)</div>
                        <div class="control-row">
                            <span class="input-label">åç§°</span>
                            <input type="text" id="input-left-name" class="text-input" value="å°é±¼å¹²" oninput="updateText('left', this.value)">
                        </div>
                        <div class="control-row">
                            <span class="input-label">å›¾ç‰‡</span>
                            <label class="file-btn" for="file-img-left">ğŸ“· ä¸Šä¼ å·¦å›¾</label>
                            <input type="file" id="file-img-left" accept="image/*" onchange="handleFile(this, 'img', 'img-left')">
                        </div>
                        <div class="control-row">
                            <span class="input-label">è¯­éŸ³ (å¯é€‰)</span>
                            <label class="file-btn" id="lbl-audio-left" for="file-audio-left">ğŸµ ä¸Šä¼ è¯­éŸ³</label>
                            <input type="file" id="file-audio-left" accept="audio/*" onchange="handleFile(this, 'audio', 'audio-left')">
                        </div>
                    </div>

                    <div class="group-box">
                        <div class="group-title">å³ä¾§ç‰©å“ (Item 2)</div>
                        <div class="control-row">
                            <span class="input-label">åç§°</span>
                            <input type="text" id="input-right-name" class="text-input" value="è€é¼ " oninput="updateText('right', this.value)">
                        </div>
                        <div class="control-row">
                            <span class="input-label">å›¾ç‰‡</span>
                            <label class="file-btn" for="file-img-right">ğŸ“· ä¸Šä¼ å³å›¾</label>
                            <input type="file" id="file-img-right" accept="image/*" onchange="handleFile(this, 'img', 'img-right')">
                        </div>
                        <div class="control-row">
                            <span class="input-label">è¯­éŸ³ (å¯é€‰)</span>
                            <label class="file-btn" id="lbl-audio-right" for="file-audio-right">ğŸµ ä¸Šä¼ è¯­éŸ³</label>
                            <input type="file" id="file-audio-right" accept="audio/*" onchange="handleFile(this, 'audio', 'audio-right')">
                        </div>
                    </div>

                    <div class="group-box">
                        <div class="group-title">ä¸»è§’å½¢è±¡</div>
                        <div class="control-row">
                            <label class="file-btn" for="file-cat">ğŸ± æ›´æ¢çŒ«å’ª</label>
                            <input type="file" id="file-cat" accept="image/*" onchange="handleFile(this, 'img', 'img-cat')">
                        </div>
                        <div class="control-row">
                            <label class="file-btn" for="file-paw">ğŸ¾ æ›´æ¢çŒ«çˆª</label>
                            <input type="file" id="file-paw" accept="image/*" onchange="handleFile(this, 'img', 'img-paw')">
                        </div>
                    </div>

                    <div class="group-box">
                        <div class="group-title">åé¦ˆéŸ³æ•ˆ</div>
                        <div class="control-row">
                            <label class="file-btn" id="lbl-audio-success" for="file-audio-success">âœ… æˆåŠŸéŸ³æ•ˆ</label>
                            <input type="file" id="file-audio-success" accept="audio/*" onchange="handleFile(this, 'audio', 'audio-success')">
                        </div>
                        <div class="control-row">
                            <label class="file-btn" id="lbl-audio-fail" for="file-audio-fail">âŒ å¤±è´¥éŸ³æ•ˆ</label>
                            <input type="file" id="file-audio-fail" accept="audio/*" onchange="handleFile(this, 'audio', 'audio-fail')">
                        </div>
                    </div>

                    <hr class="border-t border-gray-300 my-2">
                    <button class="save-btn" onclick="exportGame()">ğŸ’¾ ä¿å­˜ä¸ºç‹¬ç«‹æ¸¸æˆæ–‡ä»¶</button>
                    <p class="text-[10px] text-gray-500 mt-1 text-center">ä¸‹è½½åå¯ç›´æ¥å‘ç»™æœ‹å‹ç©</p>

                </div>
            </div>
            
            <div class="open-panel-btn" onclick="togglePanel()">âš™ï¸ è®¾ç½®</div>

            <!-- æ¸¸æˆåŒºåŸŸ -->
            <div class="cat-container">
                <img id="img-cat" src="https://api.iconify.design/noto:cat-face.svg" style="width:100%; height:100%; object-fit: contain;">
            </div>

            <div id="paw" class="cat-paw">
                <img id="img-paw" src="https://api.iconify.design/emojione:paw-prints.svg" style="width:100%; height:100%; object-fit: contain; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.2));">
            </div>

            <div class="items-area">
                <div class="item-card" onclick="trainCat('left')">
                    <div class="status-bubble" id="bubble-left">é€‰è¿™é‡Œ!</div>
                    <div class="item-circle">
                        <img id="img-left" src="https://api.iconify.design/noto:fish.svg" class="item-img">
                    </div>
                    <div id="txt-left" class="item-name-tag">å°é±¼å¹²</div>
                </div>

                <div class="item-card" onclick="trainCat('right')">
                    <div class="status-bubble" id="bubble-right">é€‰è¿™é‡Œ!</div>
                    <div class="item-circle">
                        <img id="img-right" src="https://api.iconify.design/noto:mouse-face.svg" class="item-img">
                    </div>
                    <div id="txt-right" class="item-name-tag">è€é¼ </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. æ–‡ä»¶å¤„ç†æ ¸å¿ƒ (Base64) ---
        function handleFile(input, type, targetId) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                
                if (type === 'img') {
                    // ç›´æ¥æ›´æ–°å›¾ç‰‡æ˜¾ç¤ºçš„srcï¼Œå¹¶å†™å…¥åˆ°DOMå±æ€§ä¸­ä»¥ä¾¿å¯¼å‡º
                    const img = document.getElementById(targetId);
                    img.src = base64;
                    // é‡è¦ï¼šæ ‡è®°è¯¥å…ƒç´ è¢«ä¿®æ”¹è¿‡ï¼Œè™½ç„¶srcå·²ç»å˜äº†ï¼Œä½†ä¸ºäº†å¯¼å‡ºé€»è¾‘æ›´æ¸…æ™°
                } else if (type === 'audio') {
                    // æ›´æ–°éšè—çš„audioæ ‡ç­¾çš„src
                    const audio = document.getElementById(targetId);
                    audio.src = base64;
                    // æ›´æ–°æŒ‰é’®UI
                    const btnLabel = document.querySelector(`label[for="${input.id}"]`);
                    btnLabel.classList.add('has-file');
                    btnLabel.innerText = "å·²åŠ è½½ (ç‚¹å‡»å¯æ›¿æ¢)";
                }
            };
            reader.readAsDataURL(file);
        }

        function updateText(side, val) {
            document.getElementById('txt-' + side).innerText = val || (side==='left'?'ç‰©å“1':'ç‰©å“2');
            // æ›´æ–°inputçš„valueå±æ€§ï¼Œç¡®ä¿å¯¼å‡ºæ—¶ä¿ç•™æ–‡å­—
            document.getElementById(`input-${side}-name`).setAttribute('value', val);
        }

        // --- 2. å¯¼å‡ºåŠŸèƒ½ (é­”æ³•æ‰€åœ¨) ---
        function exportGame() {
            // 1. ç¡®ä¿å½“å‰çš„é¢æ¿çŠ¶æ€æ˜¯æ”¶èµ·çš„ï¼ˆä¸ºäº†æˆªå›¾å¥½çœ‹ï¼Œæˆ–è€…å±•å¼€ä¹Ÿæ²¡å…³ç³»ï¼Œè¿™é‡Œæˆ‘ä»¬é»˜è®¤è®©å¯¼å‡ºçš„æ–‡ä»¶é¢æ¿æ˜¯æ”¶èµ·çš„ï¼‰
            const panel = document.getElementById('settingsPanel');
            const wasCollapsed = panel.classList.contains('collapsed');
            
            // 2. æ·±åº¦å…‹éš†æ•´ä¸ªæ–‡æ¡£
            const docClone = document.documentElement.cloneNode(true);
            
            // 3. æ¸…ç†ä¸éœ€è¦çš„è„šæœ¬æˆ–ä¸´æ—¶çŠ¶æ€ (å¯é€‰)
            // åœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦åšå¤ªå¤šæ¸…ç†ï¼Œå› ä¸ºæ‰€æœ‰çš„çŠ¶æ€(src, value)éƒ½å·²ç»å®æ—¶å†™åœ¨DOMé‡Œäº†
            
            // 4. ç”Ÿæˆæ–‡ä»¶
            const htmlContent = "<!DOCTYPE html>\n" + docClone.outerHTML;
            const blob = new Blob([htmlContent], { type: "text/html" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement("a");
            a.href = url;
            a.download = "çŒ«å’ªè®­ç»ƒæ¸¸æˆ_è‡ªå®šä¹‰ç‰ˆ.html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- 3. æ¸¸æˆé€»è¾‘ ---
        function playSound(id, fallbackText) {
            const audioEl = document.getElementById('audio-' + id);
            // æ£€æŸ¥æ˜¯å¦æœ‰srcä¸”ä¸ä¸ºç©º
            if (audioEl && audioEl.getAttribute('src') && audioEl.getAttribute('src').length > 10) {
                audioEl.currentTime = 0;
                audioEl.play().catch(e => console.log("Audio play error:", e));
            } else {
                // TTS å›é€€
                if (window.speechSynthesis) {
                    const u = new SpeechSynthesisUtterance(fallbackText);
                    u.lang = 'zh-CN';
                    u.rate = 1.2;
                    speechSynthesis.speak(u);
                }
            }
        }

        function playBeep() {
            // ä¼˜å…ˆæ£€æŸ¥æ˜¯å¦æœ‰ä¸Šä¼ çš„failéŸ³æ•ˆ
            const audioEl = document.getElementById('audio-fail');
            if (audioEl && audioEl.getAttribute('src') && audioEl.getAttribute('src').length > 10) {
                audioEl.currentTime = 0;
                audioEl.play();
                return;
            }
            // ç”µå­èœ‚é¸£å£°å…œåº•
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.3);
        }

        let isBusy = false;
        async function trainCat(targetSide) {
            if (isBusy) return;
            isBusy = true;

            const paw = document.getElementById('paw');
            const oppositeSide = targetSide === 'left' ? 'right' : 'left';
            const itemName = document.getElementById('txt-' + targetSide).innerText;

            // æ’­æ”¾ç‰©å“éŸ³
            playSound(targetSide, itemName);
            showBubble(targetSide);
            await wait(300);

            // 50%æ¦‚ç‡çè’™
            const catChoice = Math.random() < 0.5 ? targetSide : oppositeSide;

            if (catChoice === targetSide) {
                await movePawTo(targetSide);
                playSound('success', 'çœŸæ£’ï¼');
                await wait(1000);
                resetPaw();
            } else {
                await movePawTo(oppositeSide);
                playBeep(); // é”™è¯¯éŸ³
                await wait(1000);
                resetPaw();
                await wait(200);
                await movePawTo(targetSide); // çº æ­£
                playSound('success', 'çœŸæ£’ï¼');
                await wait(1000);
                resetPaw();
            }
            isBusy = false;
        }

        // åŠ¨ç”»ä¸UIè¾…åŠ©
        function movePawTo(side) {
            return new Promise(resolve => {
                const paw = document.getElementById('paw');
                paw.className = `cat-paw paw-${side}`;
                setTimeout(resolve, 600);
            });
        }
        function resetPaw() { document.getElementById('paw').className = `cat-paw paw-rest`; }
        function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }
        function showBubble(side) {
            const b = document.getElementById('bubble-' + side);
            b.classList.add('show-bubble');
            setTimeout(() => b.classList.remove('show-bubble'), 1000);
        }

        // é¢æ¿åˆ‡æ¢é€»è¾‘
        function togglePanel() {
            const panel = document.getElementById('settingsPanel');
            const body = document.body;
            panel.classList.toggle('collapsed');
            
            if (panel.classList.contains('collapsed')) {
                body.classList.add('panel-closed');
            } else {
                body.classList.remove('panel-closed');
            }
        }

        // å±å¹•é€‚é…
        function resizeGame() {
            const gameWidth = 900;
            const gameHeight = 600;
            const scale = Math.min((window.innerWidth - 20) / gameWidth, (window.innerHeight - 20) / gameHeight, 1);
            document.getElementById('scale-wrapper').style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizeGame);
        resizeGame();
    </script>
</body>
</html>
