<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>猫咪训练游戏（2物品版）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 核心动画：爪子摸物动作 */
        @keyframes popup {
            0% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        .popup { animation: popup 0.5s ease-in-out; }
        
        /* 爪子状态：固定位置+摸2个物品的动作 */
        .cat-paw {
            position: absolute;
            top: 220px;
            left: 50%;
            transform: translate(-50%, 0);
            width: 60px;
            height: 60px;
            transition: all 0.6s ease;
            z-index: 20;
        }
        /* 初始状态：爪子在猫咪身前 */
        .paw-rest { transform: translate(-50%, 0) !important; }
        /* 摸2个物品的爪子位置 */
        .paw-item1 { transform: translate(calc(-50% - 180px), 80px) rotate(15deg) !important; width: 65px !important; height: 65px !important; }
        .paw-item2 { transform: translate(calc(-50% + 180px), 80px) rotate(-15deg) !important; width: 65px !important; height: 65px !important; }
        
        /* 物品被摸时的按压效果 */
        .item-touched { transform: scale(0.95); transition: all 0.3s ease; }
        
        /* 上传区域样式 - 优化版：缩小字号、行距，调整尺寸 */
        .upload-area {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 30;
            background: white/90;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 220px; /* 缩小宽度 */
            font-size: 11px; /* 基础字号缩小 */
            line-height: 1.2; /* 缩小行距 */
        }
        .upload-section {
            border-bottom: 1px solid #eee;
            padding-bottom: 8px; /* 缩小内边距 */
            margin-bottom: 8px; /* 缩小外边距 */
        }
        .upload-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        .upload-btn {
            background: #10b981;
            color: white;
            padding: 6px 10px; /* 缩小按钮内边距 */
            border-radius: 4px;
            cursor: pointer;
            margin: 3px 0; /* 缩小按钮间距 */
            transition: all 0.2s;
            display: block;
            text-align: center;
            font-size: 10px; /* 按钮文字缩小 */
        }
        .upload-btn:hover {
            background: #059669;
        }
        .file-input {
            display: none;
        }
        .item-name-input {
            margin: 3px 0; /* 缩小输入框间距 */
            padding: 4px; /* 缩小输入框内边距 */
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100px; /* 缩小输入框宽度 */
            font-size: 10px; /* 输入框文字缩小 */
        }
        .upload-label {
            font-size: 10px; /* 标签文字缩小 */
            font-weight: 500;
            margin-bottom: 2px; /* 缩小标签下边距 */
            color: #666;
            display: block;
        }
        .upload-title {
            font-weight: bold;
            font-size: 12px; /* 标题文字缩小 */
            margin-bottom: 6px; /* 缩小标题下边距 */
            display: block;
        }
    </style>
<base target="_blank">
</head>
<body class="bg-gray-100 flex flex-col items-center py-10">
    <!-- 游戏容器：固定尺寸，所有元素位置永久不变 -->
    <div class="w-[900px] h-[600px] bg-white rounded-2xl shadow-lg relative overflow-hidden">
        <!-- 背景：模拟地板 -->
        <div class="absolute inset-0 bg-gradient-to-b from-yellow-50 to-yellow-100"></div>
        
        <!-- 自定义上传入口（左上角） - 优化布局 -->
        <div class="upload-area">
            <span class="upload-title">自定义图案和音效</span>
            
            <!-- 猫咪上传 -->
            <div class="upload-section">
                <div class="upload-label">猫咪形象</div>
                <label for="upload-cat" class="upload-btn">选择图片</label>
                <input type="file" id="upload-cat" class="file-input" accept="image/*">
            </div>
            
            <!-- 猫爪上传 -->
            <div class="upload-section">
                <div class="upload-label">猫爪图案</div>
                <label for="upload-paw" class="upload-btn">选择图片</label>
                <input type="file" id="upload-paw" class="file-input" accept="image/*">
            </div>
            
            <!-- 物品1上传 -->
            <div class="upload-section">
                <div class="upload-label">物品1</div>
                <input type="text" id="item1-name" class="item-name-input" placeholder="纸巾" value="纸巾">
                <label for="upload-item1" class="upload-btn">选择图片</label>
                <input type="file" id="upload-item1" class="file-input" accept="image/*">
            </div>
            
            <!-- 物品2上传 -->
            <div class="upload-section">
                <div class="upload-label">物品2</div>
                <input type="text" id="item2-name" class="item-name-input" placeholder="红萝卜" value="红萝卜">
                <label for="upload-item2" class="upload-btn">选择图片</label>
                <input type="file" id="upload-item2" class="file-input" accept="image/*">
            </div>
            
            <!-- 音效上传部分 -->
            <div class="upload-section">
                <div class="upload-label">真棒音效</div>
                <label for="upload-success-sound" class="upload-btn">选择MP3</label>
                <input type="file" id="upload-success-sound" class="file-input" accept="audio/mp3">
            </div>
            
            <div class="upload-section">
                <div class="upload-label">错误音效</div>
                <label for="upload-error-sound" class="upload-btn">选择MP3</label>
                <input type="file" id="upload-error-sound" class="file-input" accept="audio/mp3">
            </div>
        </div>
        
        <!-- 固定位置：猫咪（正中间上方） -->
        <div class="absolute top-[80px] left-1/2 transform -translate-x-1/2 w-[200px] h-[200px] z-10">
            <img id="cat-img" src="./tupian/cat.png" alt="猫咪" class="w-full h-full object-cover rounded-full border-4 border-white shadow-md">
            <!-- 猫咪爪子（核心动效元素：摸物动作） -->
            <div id="cat-paw" class="cat-paw paw-rest">
                <img id="paw-img" src="./tupian/zhua.png" alt="猫爪" class="w-full h-full object-contain">
            </div>
        </div>

        <!-- 固定位置：2个物品（底部左右对称排列） -->
        <!-- 物品1 -->
        <div class="absolute bottom-[80px] left-[150px] w-[150px] h-[150px] z-5 text-center" id="item1">
            <img id="item1-img" src="./tupian/zhi.png" alt="物品1" class="w-full h-full object-cover rounded-lg border-3 border-white shadow-md">
            <div id="item1-text" class="mt-3 font-bold text-xl text-gray-800">纸巾</div>
        </div>
        <!-- 物品2 -->
        <div class="absolute bottom-[80px] right-[150px] w-[150px] h-[150px] z-5 text-center" id="item2">
            <img id="item2-img" src="./tupian/luobo.png" alt="物品2" class="w-full h-full object-cover rounded-lg border-3 border-white shadow-md">
            <div id="item2-text" class="mt-3 font-bold text-xl text-gray-800">红萝卜</div>
        </div>

        <!-- 指令按钮（底部中间，2个按钮） -->
        <div class="absolute bottom-[20px] left-1/2 transform -translate-x-1/2 flex gap-8">
            <button id="btn-item1" class="px-10 py-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-xl font-bold shadow-lg">摸纸巾</button>
            <button id="btn-item2" class="px-10 py-4 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition text-xl font-bold shadow-lg">摸红萝卜</button>
        </div>

        <!-- 弹出提示层（不遮挡猫咪） -->
        <div id="popup" class="fixed top-[50px] left-1/2 transform -translate-x-1/2 z-100 hidden bg-white/90 px-8 py-4 rounded-xl shadow-2xl">
            <div class="text-7xl font-bold popup"></div>
        </div>

        <!-- 音频资源：替换为精准匹配的音效 -->
        <!-- 选对：高声调女声“真棒！” -->
        <audio id="success-audio" preload="auto">
            <source src="./shengyin/good.MP3" type="audio/mpeg">
        </audio>
        <!-- 选错：错误提示音效 -->
        <audio id="error-audio" preload="auto">
            <source src="./shengyin/cuo.MP3" type="audio/mpeg">
        </audio>
    </div>

    <script>
        // 核心配置：2个物品的基础信息
        const ITEM_CONFIG = [
            { id: 'item1', name: '纸巾', pawClass: 'paw-item1', btnId: 'btn-item1' },
            { id: 'item2', name: '红萝卜', pawClass: 'paw-item2', btnId: 'btn-item2' }
        ];

        // 核心状态管理
        const state = {
            currentCommand: '',
            isInteracting: false,
            paw: document.getElementById('cat-paw'),
            pawImg: document.getElementById('paw-img'),
            catImg: document.getElementById('cat-img'),
            popup: document.getElementById('popup'),
            successAudio: document.getElementById('success-audio'),
            errorAudio: document.getElementById('error-audio'),
            items: ITEM_CONFIG.map(item => ({
                ...item,
                element: document.getElementById(item.id),
                imgElement: document.getElementById(`${item.id}-img`),
                textElement: document.getElementById(`${item.id}-text`),
                btnElement: document.getElementById(item.btnId)
            }))
        };

        // ========== 全自定义上传功能 ==========
        // 1. 猫咪图片上传
        const catUpload = document.getElementById('upload-cat');
        catUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    state.catImg.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // 2. 猫爪图片上传
        const pawUpload = document.getElementById('upload-paw');
        pawUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    state.pawImg.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // 3. 物品上传和名称修改
        ITEM_CONFIG.forEach((item, index) => {
            // 图片上传
            const uploadInput = document.getElementById(`upload-${item.id}`);
            uploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        state.items[index].imgElement.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // 名称修改
            const nameInput = document.getElementById(`${item.id}-name`);
            nameInput.addEventListener('input', (e) => {
                const newName = e.target.value.trim() || `物品${index+1}`;
                state.items[index].textElement.textContent = newName;
                state.items[index].btnElement.textContent = `摸${newName}`;
                state.items[index].name = newName;
            });
        });

        // 4. 音效上传功能
        const successSoundUpload = document.getElementById('upload-success-sound');
        successSoundUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'audio/mp3') {
                const reader = new FileReader();
                reader.onload = (event) => {
                    state.successAudio.src = event.target.result;
                    // 预加载新音频
                    state.successAudio.preload = 'auto';
                    state.successAudio.load();
                };
                reader.readAsDataURL(file);
            } else {
                alert('请上传MP3格式的音频文件');
            }
        });

        const errorSoundUpload = document.getElementById('upload-error-sound');
        errorSoundUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'audio/mp3') {
                const reader = new FileReader();
                reader.onload = (event) => {
                    state.errorAudio.src = event.target.result;
                    // 预加载新音频
                    state.errorAudio.preload = 'auto';
                    state.errorAudio.load();
                };
                reader.readAsDataURL(file);
            } else {
                alert('请上传MP3格式的音频文件');
            }
        });

        // ========== 游戏核心逻辑 ==========
        // 绑定按钮事件
        state.items.forEach(item => {
            item.btnElement.addEventListener('click', () => handleCommand(item.name, item));
        });

        /**
         * 处理指令：核心摸物逻辑
         * @param {string} targetName - 目标物品名称
         * @param {object} targetItem - 目标物品配置
         */
        function handleCommand(targetName, targetItem) {
            if (state.isInteracting) return;
            state.isInteracting = true;
            state.currentCommand = targetName;

            // 步骤1：重置所有状态（爪子回位，物品取消按压）
            resetAllStates();

            // 步骤2：随机选一个物品（排除法起始）
            const randomItems = [...state.items].filter(item => item.name !== targetName);
            const randomFirst = randomItems.length > 0 
                ? randomItems[Math.floor(Math.random() * randomItems.length)] 
                : state.items[Math.floor(Math.random() * state.items.length)];
            
            // 步骤3：执行第一个摸物动作
            setTimeout(() => {
                doTouchAction(randomFirst);

                // 步骤4：检查是否选对
                setTimeout(() => {
                    if (randomFirst.name === targetName) {
                        // 选对：红色真棒 + 高声调女声“真棒！” + 物品保持按压
                        showPopup('真棒！', 'text-red-600');
                        // 确保音效正确播放（重置播放位置）
                        state.successAudio.currentTime = 0;
                        state.successAudio.play();
                        resetAfterInteraction();
                    } else {
                        // 选错：绿色错误 + 错误音效
                        showPopup('错误！', 'text-green-600');
                        // 确保音效正确播放（重置播放位置）
                        state.errorAudio.currentTime = 0;
                        state.errorAudio.play();

                        // 步骤5：排除法 - 摸另一个正确物品
                        setTimeout(() => {
                            // 先重置爪子位置
                            state.paw.classList.remove(...state.items.map(item => item.pawClass));
                            state.paw.classList.add('paw-rest');
                            // 取消错误物品的按压
                            randomFirst.element.classList.remove('item-touched');

                            // 再摸正确物品
                            setTimeout(() => {
                                doTouchAction(targetItem);
                                
                                // 选对最终结果
                                setTimeout(() => {
                                    showPopup('真棒！', 'text-red-600');
                                    // 确保音效正确播放（重置播放位置）
                                    state.successAudio.currentTime = 0;
                                    state.successAudio.play();
                                    resetAfterInteraction();
                                }, 800);
                            }, 500);
                        }, 1000);
                    }
                }, 800);
            }, 500);
        }

        /**
         * 执行摸物动作：爪子搭在物品上 + 物品按压效果
         * @param {object} item - 要摸的物品配置
         */
        function doTouchAction(item) {
            // 移除其他爪子样式，添加当前物品的爪子样式
            state.paw.classList.remove(...state.items.map(i => i.pawClass));
            state.paw.classList.add(item.pawClass);
            // 物品按压效果
            item.element.classList.add('item-touched');
        }

        /**
         * 显示弹出提示（不遮挡猫咪）
         * @param {string} text - 提示文字
         * @param {string} className - 样式类（颜色）
         */
        function showPopup(text, className) {
            state.popup.innerHTML = `<div class="text-7xl font-bold popup ${className}">${text}</div>`;
            state.popup.classList.remove('hidden');
            
            // 1.5秒后隐藏弹窗
            setTimeout(() => {
                state.popup.classList.add('hidden');
            }, 1500);
        }

        /**
         * 重置所有状态
         */
        function resetAllStates() {
            // 爪子回初始位置
            state.paw.className = 'cat-paw paw-rest';
            // 取消所有物品按压
            state.items.forEach(item => item.element.classList.remove('item-touched'));
            // 隐藏弹窗
            state.popup.classList.add('hidden');
        }

        /**
         * 交互结束后重置
         */
        function resetAfterInteraction() {
            setTimeout(() => {
                resetAllStates();
                state.isInteracting = false; // 恢复可点击
            }, 2000);
        }
    </script>
</body>
</html>